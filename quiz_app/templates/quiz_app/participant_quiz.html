<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dein Quiz</title>
    <style>
        /* Optional: Grundlegende Stile für bessere Lesbarkeit */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }

        /* Stil für die Buttons und das Formular */
        /* Wir setzen Flexbox direkt auf ein div, das die Buttons umschließt,
           oder lassen es einfach auf dem Formular und passen die Anordnung an. */
        
        /* Die Labels der Radio-Buttons sollen untereinander bleiben */
        #answer-form label {
            display: block; /* Jedes Label in einer neuen Zeile */
            margin-bottom: 5px;
        }

        /* Container für die Buttons, damit sie nebeneinander liegen */
        .button-container {
            display: flex; /* Nutzt Flexbox, um Elemente nebeneinander anzuordnen */
            gap: 10px; /* Fügt Abstand zwischen den Buttons hinzu */
            margin-top: 15px; /* Abstand zu den Radio-Buttons */
        }

        .button-container button {
            padding: 10px 20px; /* Gleiche Polsterung für beide Buttons */
            font-size: 16px; /* Gleiche Schriftgröße */
            cursor: pointer;
            border: none;
            border-radius: 5px; /* Abgerundete Ecken */
            white-space: nowrap; /* Verhindert Zeilenumbruch im Button-Text */
        }

        /* Stil für den "Antwort abschicken" Button */
        .button-container button[type="submit"] {
            background-color: #007bff; /* Beispiel-Farbe Blau */
            color: white;
        }

        .button-container button[type="submit"]:hover {
            background-color: #0056b3;
        }

        /* Stil für den "Aktualisieren" Button */
        #refresh-button { /* Da es nur einen Refresh-Button gibt, kann die ID genutzt werden */
            background-color: #6c757d; /* Beispiel-Farbe Grau */
            color: white;
        }

        #refresh-button:hover {
            background-color: #5a6268;
        }
    </style>
</head>
<body>
    <h1>Willkommen, {{ participant.name }}!</h1>
    <!--<h2>Session: {{ session.name }}</h2>-->

    <div id="live-question-area">
    <h3 id="question-category">Bitte warten Sie auf die nächste Frage...</h3>
    <h3 id="question-text"></h3>

    <form id="answer-form" style="display:none;">
        {% csrf_token %}
        <input type="hidden" name="question_id" value="">
        <div id="answers-container">
            <!-- Hier werden die Antwort-Optionen als Radio-Buttons per JS eingefügt -->
        </div>
        <div class="button-container">
            <button type="submit">Antwort abschicken</button>
            <button type="button" id="refresh-button">Seite aktualisieren</button>
        </div>
    </form>
</div>

	<div id="status-message" style="margin-top: 20px; color: green;"></div>

    <script>
		/*
		NOTE: big garbage can (these were my first attempts to trigger communication between participants and admin dashboard)


		const sessionId = "{{ session.id }}";
	let currentQuestionId = null;

	function createAnswerOption(answerText) {
		const label = document.createElement('label');
		label.style.display = 'block';
		label.style.marginBottom = '5px';

		const input = document.createElement('input');
		input.type = 'radio';
		input.name = 'chosen_answer_text';
		input.value = answerText;
		input.required = true;

		label.appendChild(input);
		label.append(' ' + answerText);

		return label;
	}

	function fetchCurrentQuestion() {
    fetch(`/api/current-question/${sessionId}/`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Netzwerkfehler beim Laden der Frage');
            }
            return response.json();
        })
        .then(data => {
            const questionForm = document.getElementById('answer-form');
            const questionTextElem = document.getElementById('question-text');
            const questionCategoryElem = document.getElementById('question-category');
            const answersContainer = document.getElementById('answers-container');
            const statusDiv = document.getElementById('status-message');

            if (data.id && data.id !== currentQuestionId) {
                currentQuestionId = data.id;

                // Frage und Kategorie anzeigen
                questionTextElem.textContent = data.text;
                questionCategoryElem.textContent = 'Kategorie: ' + data.category;

                // Verstecke Statusmeldung
                statusDiv.textContent = '';

                // Formular anzeigen
                questionForm.style.display = 'block';

                // Frage-ID setzen (für das Formular)
                questionForm.querySelector('input[name="question_id"]').value = data.id;

                // Antworten löschen und neu hinzufügen
                answersContainer.innerHTML = '';
                data.answers.forEach(answerText => {
                    const option = createAnswerOption(answerText);
                    answersContainer.appendChild(option);
                });

                // Submit-Button aktivieren (für den Fall, dass er deaktiviert wurde)
                questionForm.querySelector('button[type="submit"]').disabled = false;
            } else if (!data.id) {
                // Keine Frage verfügbar -> Formular verstecken und Nachricht anzeigen
                questionForm.style.display = 'none';
                questionTextElem.textContent = '';
                questionCategoryElem.textContent = 'Bitte warten Sie auf die nächste Frage...';
            }
        })
        .catch(error => {
            console.error('Fehler beim Laden der Frage:', error);
        });
	}

	// Initiales Laden + Intervall
	fetchCurrentQuestion();
	setInterval(fetchCurrentQuestion, 3000);

	// Formular-Submit bleibt wie bisher:
	document.getElementById('answer-form').addEventListener('submit', function(event) {
		event.preventDefault();

		const formData = new FormData(this);
		const questionId = formData.get('question_id');
		const chosenAnswerText = formData.get('chosen_answer_text');
		const statusDiv = document.getElementById('status-message');
		const participantId = "{{ participant.id }}";

		fetch('{% url "submit_answer" %}', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
				'X-CSRFToken': formData.get('csrfmiddlewaretoken')
			},
			body: JSON.stringify({
				question_id: questionId,
				chosen_answer_text: chosenAnswerText,
				participant_id: participantId
			})
		})
		.then(response => response.json())
		.then(data => {
			statusDiv.textContent = data.message;
			if (data.status === 'success') {
				document.getElementById('answer-form').querySelector('button[type="submit"]').disabled = true;
			}
		})
		.catch(error => {
			console.error('Error:', error);
			statusDiv.textContent = 'Ein Fehler ist aufgetreten.';
		});
	});

	document.getElementById('refresh-button').addEventListener('click', function() {
		location.reload();
	});


	document.getElementById('answer-form').addEventListener('submit', function(event) {
		event.preventDefault(); 

		const formData = new FormData(this);
		const questionId = formData.get('question_id');
		const chosenAnswerText = formData.get('chosen_answer_text'); 
		const statusDiv = document.getElementById('status-message');
		const participantId = "{{ participant.id }}";

		fetch('{% url "submit_answer" %}', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
				'X-CSRFToken': formData.get('csrfmiddlewaretoken')
			},
			body: JSON.stringify({
				question_id: questionId,
				chosen_answer_text: chosenAnswerText,
				participant_id: participantId
			})
		})
		.then(response => response.json())
		.then(data => {
			statusDiv.textContent = data.message;
			if (data.status === 'success') {
				document.getElementById('answer-form').querySelector('button[type="submit"]').disabled = true;
			}
		})
		.catch(error => {
			console.error('Error:', error);
			statusDiv.textContent = 'Ein Fehler ist aufgetreten.';
		});
	});

	document.getElementById('refresh-button').addEventListener('click', function() {
		location.reload(); 
	});

	const sessionId = {{ session.id }};  // Vom Django-Template übergeben
	let currentQuestionId = null;

	function fetchCurrentQuestion() {
		fetch(`/api/current-question/${sessionId}/`)
			.then(response => response.json())
			.then(data => {
				if (data.id && data.id !== currentQuestionId) {
					currentQuestionId = data.id;
					document.getElementById('question-text').textContent = data.text;
					document.getElementById('question-category').textContent = 'Kategorie: ' + data.category;
				}
			})
			.catch(error => console.error('Fehler beim Laden der Frage:', error));
	}

	// Alle 3 Sekunden nach neuer Frage fragen
	setInterval(fetchCurrentQuestion, 3000);

	// Direkt beim Laden einmal holen
	fetchCurrentQuestion();

	*/

	</script>
</body>
</html>